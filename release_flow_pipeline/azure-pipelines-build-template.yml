jobs:
    - job:
      variables:
          imageName: $
          env: $
          tags: $
      displayName: "Build Golang app"
      steps:
          - task: Docker@2
            displayName: Build image
            inputs:
                repository: $(variables.imageName)
                command: build
                Dockerfile: $(System.DefaultWorkingDirectory)/Dockerfile
                tags: $(variables.tags)
          - script: |
                docker save $(variables.imageName):$(variables.tags) > go.tar
          - task: PublishBuildArtifacts@1
            displayName: Publish package ready for $(variables.env)
            inputs:
                PathtoPublish: "$(System.DefaultWorkingDirectory)/go.tar"
                artifactName: "image"
          - script: |
                docker images
